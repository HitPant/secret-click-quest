<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>...</title>
  <style>
    :root{
      --bg1:#070a12;
      --bg2:#0b1224;
      --card:#0b1224cc;
      --stroke: rgba(255,255,255,.12);
      --text:#f8fafc;
      --muted:#cbd5e1;
      --accent:#fb7185;
      --accent2:#f43f5e;
      --good:#22c55e;
      --shadow: 0 28px 90px rgba(0,0,0,.65);
      --radius: 18px;
      --speed: 220ms;
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: var(--font);
      color: var(--text);
      background:
        radial-gradient(900px 540px at 15% 25%, rgba(251,113,133,.10), transparent 60%),
        radial-gradient(900px 540px at 85% 30%, rgba(244,63,94,.08), transparent 60%),
        linear-gradient(135deg, var(--bg1), var(--bg2));
      display:grid;
      place-items:center;
      padding: 22px;
      overflow:hidden;
    }

    .card{
      width: min(640px, 96vw);
      background: var(--card);
      border: 1px solid var(--stroke);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(12px);
      overflow:hidden;
    }

    .top{
      padding: 18px 18px 14px;
      border-bottom: 1px solid var(--stroke);
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 12px;
    }

    .meta{
      display:flex;
      flex-direction:column;
      gap: 6px;
    }

    .headline{
      margin:0;
      font-size: clamp(18px, 2.5vw, 22px);
      letter-spacing:.2px;
      line-height:1.2;
    }

    .sub{
      margin:0;
      font-size: 13px;
      color: var(--muted);
      opacity: .92;
      line-height:1.35;
    }

    .stats{
      text-align:right;
      font-size: 12px;
      color: var(--muted);
      display:flex;
      flex-direction:column;
      gap: 6px;
      min-width: 160px;
    }

    .pill{
      display:inline-flex;
      justify-content:flex-end;
      gap: 8px;
      align-items:center;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      white-space:nowrap;
    }

    .body{
      padding: 16px 18px 18px;
    }

    /* 4x4 grid */
    .grid{
      display:grid;
      grid-template-columns: repeat(4, minmax(0,1fr));
      gap: 10px;
      margin-top: 12px;
    }

    .tile{
      height: 72px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      cursor:pointer;
      transition: transform var(--speed) ease, background var(--speed) ease, border-color var(--speed) ease;
      position:relative;
      overflow:hidden;
      user-select:none;
    }

    .tile:hover{
      transform: translateY(-2px);
      background: rgba(255,255,255,.08);
      border-color: rgba(255,255,255,.20);
    }
    .tile:active{
      transform: translateY(0px) scale(.99);
    }

    .mark{
      position:absolute;
      inset:0;
      display:grid;
      place-items:center;
      font-weight: 900;
      font-size: 18px;
      opacity:0;
      transform: scale(.96);
      transition: opacity var(--speed) ease, transform var(--speed) ease;
      pointer-events:none;
    }

    .tile.revealed .mark{
      opacity:1;
      transform: scale(1);
    }

    .tile.wrong{
      border-color: rgba(251,113,133,.35);
      background: rgba(251,113,133,.10);
    }

    .tile.right{
      border-color: rgba(34,197,94,.40);
      background: rgba(34,197,94,.12);
    }

    .tile.locked{
      pointer-events:none;
      opacity:.75;
    }

    .footer{
      padding: 14px 18px 18px;
      border-top: 1px solid var(--stroke);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
    }

    .hintBox{
      font-size: 13px;
      color: var(--muted);
      line-height:1.35;
      min-height: 18px;
    }

    .btnRow{
      display:flex;
      gap: 10px;
      align-items:center;
    }

    .btn{
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 12px;
      cursor:pointer;
      transition: background var(--speed) ease, transform var(--speed) ease;
      font-weight: 850;
      font-size: 13px;
      user-select:none;
    }
    .btn:hover{ background: rgba(255,255,255,.10); }
    .btn:active{ transform: scale(.98); }

    .btnPrimary{
      background: linear-gradient(135deg, var(--accent2), var(--accent));
      border-color: rgba(251,113,133,.35);
      box-shadow: 0 14px 30px rgba(244,63,94,.18);
    }
    .btnPrimary:hover{
      background: linear-gradient(135deg, #fb7185, #ff9fb1);
    }

    /* Reveal overlay */
    .overlay{
      position: fixed;
      inset: 0;
      background: rgba(2,6,23,.72);
      backdrop-filter: blur(10px);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 22px;
      z-index: 10;
    }

    .overlay.show{
      display:flex;
      animation: fadeIn 420ms ease forwards;
    }

    @keyframes fadeIn{
      from{ opacity:0; }
      to{ opacity:1; }
    }

    .revealCard{
      width: min(560px, 96vw);
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(15,23,42,.82);
      box-shadow: 0 40px 120px rgba(0,0,0,.65);
      padding: 26px 22px 20px;
      text-align:center;
      position:relative;
      overflow:hidden;
    }

    .ring{
      font-size: 64px;
      margin-bottom: 10px;
      filter: drop-shadow(0 14px 28px rgba(0,0,0,.35));
      animation: pop 650ms cubic-bezier(.2,.9,.2,1) forwards;
      transform: scale(.85);
      opacity:0;
    }

    @keyframes pop{
      to{ transform: scale(1); opacity:1; }
    }

    .revealTitle{
      margin: 0 0 6px;
      font-size: 28px;
      letter-spacing:.2px;
    }
    .revealMsg{
      margin: 0 auto 16px;
      color: var(--muted);
      font-size: 15px;
      line-height:1.6;
      max-width: 54ch;
    }

    .tiny{
      font-size: 12px;
      color: var(--muted);
      opacity:.9;
    }

    .pulse{
      animation: pulse 320ms ease;
    }
    @keyframes pulse{
      50%{ transform: scale(1.01); }
    }
  </style>
</head>

<body>
  <!-- Wrong click sound: put wrong.mp3 in repo root -->
  <audio id="wrongSound" src="wrong.mp3" preload="auto"></audio>

  <div class="card" id="card">
    <div class="top">
      <div class="meta">
        <h1 class="headline">Choose wisely.</h1>
        <p class="sub" id="sub">Tap once anywhere to enable sound. Then begin.</p>
      </div>

      <div class="stats">
        <div class="pill"><span>Attempts</span><strong id="attempts">0</strong></div>
        <div class="pill"><span>Streak</span><strong id="streak">0</strong></div>
      </div>
    </div>

    <div class="body">
      <div class="grid" id="grid"></div>
    </div>

    <div class="footer">
      <div class="hintBox" id="hintBox">Hint: your first instinct is usually suspicious.</div>
      <div class="btnRow">
        <button class="btn" id="resetBtn">Reset</button>
        <button class="btn btnPrimary" id="hardResetBtn" title="New secret location">New Game</button>
      </div>
    </div>
  </div>

  <div class="overlay" id="overlay" aria-hidden="true">
    <div class="revealCard">
      <div class="ring">üíç</div>
      <h2 class="revealTitle">Happy Propose Day</h2>
      <p class="revealMsg">
        Consider this an official proposal to keep being awesome.
      </p>
      <div class="tiny">Call Me DADDY.</div>
      <div style="margin-top:16px;">
        <button class="btn btnPrimary" id="playAgain">Play Again</button>
      </div>
    </div>
  </div>

<script>
  // -------------------------
  // Settings
  // -------------------------
  const GRID_SIZE = 16;        // 12..20 also fine (layout is 4 columns currently)
  const COLS = 4;              // keep 4 for GRID_SIZE=16; if you change GRID_SIZE, tell me and I‚Äôll auto-fit
  const MOVE_AFTER_WRONG = 3;  // move target after 3 wrong attempts
  const FLASH_MS = 320;        // how long wrong mark flashes

  // -------------------------
  // State
  // -------------------------
  const gridEl = document.getElementById("grid");
  const hintBox = document.getElementById("hintBox");
  const attemptsEl = document.getElementById("attempts");
  const streakEl = document.getElementById("streak");
  const overlay = document.getElementById("overlay");
  const card = document.getElementById("card");
  const subEl = document.getElementById("sub");

  const wrongSound = document.getElementById("wrongSound");
  let soundReady = false;

  let targetIndex = randInt(GRID_SIZE);
  let lastGuessIndex = null;
  let attempts = 0;
  let streak = 0;
  let wrongCountSinceMove = 0;
  let found = false;
  let busy = false; // prevents spam-click during flash

  // -------------------------
  // Audio unlock (browser requirement)
  // -------------------------
  function unlockSound(){
    if (soundReady) return;
    soundReady = true;
    subEl.textContent = "Sound enabled ‚úÖ";
    wrongSound.volume = 0.9;
    wrongSound.play().then(() => {
      wrongSound.pause();
      wrongSound.currentTime = 0;
    }).catch(() => {
      // If blocked, keep UI calm
      subEl.textContent = "Sound may be blocked (game still works).";
    });
  }
  document.addEventListener("pointerdown", unlockSound, { once:true });

  function playWrong(){
    if (!soundReady) return;
    try{
      wrongSound.currentTime = 0;
      wrongSound.play().catch(()=>{});
    }catch(e){}
  }

  // -------------------------
  // Helpers
  // -------------------------
  function randInt(n){ return Math.floor(Math.random() * n); }

  function distance(a, b){
    // Manhattan distance in a COLS-based grid
    const ax = a % COLS, ay = Math.floor(a / COLS);
    const bx = b % COLS, by = Math.floor(b / COLS);
    return Math.abs(ax - bx) + Math.abs(ay - by);
  }

  function setHint(text){
    hintBox.textContent = text;
  }

  function updateStats(){
    attemptsEl.textContent = String(attempts);
    streakEl.textContent = String(streak);
  }

  function moveTarget(){
    let next = randInt(GRID_SIZE);
    while(next === targetIndex) next = randInt(GRID_SIZE);
    targetIndex = next;
    wrongCountSinceMove = 0;

    card.classList.remove("pulse");
    void card.offsetWidth;
    card.classList.add("pulse");
  }

  function lockGrid(){
    [...gridEl.children].forEach(tile => tile.classList.add("locked"));
  }

  function revealWin(tile){
    found = true;
    tile.classList.add("right","revealed");
    tile.querySelector(".mark").textContent = "üíç";
    lockGrid();

    setTimeout(() => {
      overlay.classList.add("show");
      overlay.setAttribute("aria-hidden", "false");
    }, 520);
  }

  function flashWrong(tile){
    tile.classList.add("wrong","revealed");
    tile.querySelector(".mark").textContent = "‚úñ";
    setTimeout(() => {
      // Only clear if game not already won
      if (!found){
        tile.classList.remove("wrong","revealed");
        tile.querySelector(".mark").textContent = "";
      }
    }, FLASH_MS);
  }

  // -------------------------
  // Game logic
  // -------------------------
  function onPick(index, tile){
    if(found || busy) return;

    attempts++;
    updateStats();

    if(index === targetIndex){
      streak++;
      updateStats();
      setHint("Interesting‚Ä¶ you actually did it.");
      revealWin(tile);
      return;
    }

    // Wrong
    playWrong();
    streak = 0;
    updateStats();

    busy = true;
    flashWrong(tile);
    setTimeout(() => { busy = false; }, FLASH_MS - 20);

    wrongCountSinceMove++;

    // Hint: warmer/colder vs last guess
    let msg = "Nope.";
    if(lastGuessIndex !== null){
      const prevD = distance(lastGuessIndex, targetIndex);
      const curD  = distance(index, targetIndex);
      if(curD < prevD) msg = "Warmer.";
      else if(curD > prevD) msg = "Colder.";
      else msg = "Neither warmer nor colder. Sideways move üòÑ";
    } else {
      const d = distance(index, targetIndex);
      if(d <= 1) msg = "Very warm.";
      else if(d <= 2) msg = "Warm-ish.";
      else msg = "Cold start.";
    }

    // Flavor text + movement
    if(wrongCountSinceMove === 2) msg += " Don‚Äôt get dramatic.";
    if(wrongCountSinceMove >= MOVE_AFTER_WRONG){
      msg += " Fine. I moved it.";
      moveTarget();
    }

    setHint(msg);
    lastGuessIndex = index;
  }

  // -------------------------
  // Render
  // -------------------------
  function buildGrid(){
    gridEl.innerHTML = "";
    for(let i=0;i<GRID_SIZE;i++){
      const tile = document.createElement("button");
      tile.className = "tile";
      tile.setAttribute("aria-label", "tile");

      const mark = document.createElement("div");
      mark.className = "mark";
      mark.textContent = "";
      tile.appendChild(mark);

      tile.addEventListener("click", () => onPick(i, tile));
      gridEl.appendChild(tile);
    }
  }

  function reset(reseed=false){
    found = false;
    busy = false;
    attempts = 0;
    streak = 0;
    wrongCountSinceMove = 0;
    lastGuessIndex = null;

    if(reseed) targetIndex = randInt(GRID_SIZE);

    overlay.classList.remove("show");
    overlay.setAttribute("aria-hidden", "true");

    buildGrid();
    updateStats();
    setHint("Hint: your first instinct is usually suspicious.");
  }

  // Buttons
  document.getElementById("resetBtn").addEventListener("click", () => reset(false));
  document.getElementById("hardResetBtn").addEventListener("click", () => reset(true));
  document.getElementById("playAgain").addEventListener("click", () => reset(true));

  // Init
  reset(true);
</script>
</body>
</html>
